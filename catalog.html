<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Catalog - LibraConnect</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Your Custom CSS -->
    <link rel="stylesheet" href="assets/css/catalog.css">
    
    <!-- Header Styles Only - Footer styling removed -->
    <style>
        /* ELEGANT MUTED LIBRARY THEME - Sophisticated & Coordinated */
        :root {
            --dusty-blue: #6B8E9C;
            --sage-green: #8A9B8F;
            --warm-taupe: #A89B8C;
            --soft-cream: #F8F7F4;
            --charcoal: #4A4A4A;
            --mauve: #9A8B8F;
            --dusty-rose: #B8A6A6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'SF Pro Display', -apple-system, sans-serif;
            background: linear-gradient(135deg, #FCFCFC 0%, #F8F7F4 100%);
            color: var(--charcoal);
            line-height: 1.6;
            font-weight: 400;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        main {
            flex: 1;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ELEGANT NAVIGATION */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 1rem 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--charcoal);
        }

        .nav-brand a {
            color: var(--charcoal);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-brand a::before {
            content: "â—ˆ";
            color: var(--dusty-blue);
            font-size: 1.4rem;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 1.2rem;
            margin: 0;
            padding: 0;
            align-items: center;
        }

        .nav-menu li a {
            color: var(--charcoal);
            text-decoration: none;
            font-weight: 500;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .nav-menu li a:hover,
        .nav-menu li a.active {
            background: rgba(107, 142, 156, 0.1);
            color: var(--dusty-blue);
            border-color: rgba(107, 142, 156, 0.2);
        }

        .login-btn {
            background: var(--dusty-blue);
            color: white !important;
        }

        .login-btn:hover {
            background: var(--sage-green) !important;
        }

        /* Mobile Menu Styles */
        .menu-icon {
            display: none;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            color: var(--charcoal);
        }
        
        /* Mobile Styles */
        @media (max-width: 768px) {
            .menu-icon {
                display: block;
            }
            .nav-menu {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                padding: 1rem;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            .nav-menu.open {
                display: flex;
            }
        }
    </style>
</head>
<body>
    <!-- Header will be loaded here -->
    <div id="header"></div>

    <!-- Main Content -->
    <main class="container py-5">
           <!-- HERO SECTION -->
        <div class="text-center mb-5">
            <h1 class="fw-bold">Book Catalog</h1>
            <p class="lead">Search and filter through thousands of books</p>
        </div>
        <!-- Search Section -->
        <section class="search-section">
            <div class="search-container">
                <!-- Genre Filter -->
                <select id="genreFilter" class="genre-filter">
                    <option value="">All Genres</option>
                    <option value="Classic Literature">Classic Literature</option>
                    <option value="Fiction">Fiction</option>
                    <option value="Dystopian Fiction">Dystopian Fiction</option>
                    <option value="Romance">Romance</option>
                    <option value="Fantasy">Fantasy</option>
                    <option value="Science Fiction">Science Fiction</option>
                    <option value="Adventure">Adventure</option>
                    <option value="Action">Action</option>
                    <option value="Metafiction">Metafiction</option>
                    <option value="Mystery/Thriller">Mystery/Thriller</option>
                </select>
                
                <input type="text" id="searchInput" class="search-input" placeholder="Search for books by title, author, or genre...">
                <button class="search-btn" id="searchButton">Search</button>
            </div>
        </section>

        <!-- Books Grid -->
        <section class="books-grid" id="booksContainer">
            <!-- Books will be dynamically inserted here by JavaScript -->
        </section>

        <!-- No Results Message -->
        <div id="noResults" class="no-results">
            <h3>No books found</h3>
            <p>Try adjusting your search terms or browse all books</p>
        </div>
    </main>

    <!-- Footer will be loaded here -->
    <div id="footer"></div>

    <!-- ONLY USE INCLUDE.JS - REMOVE DUPLICATE HEADER LOADING -->
   <script src="./js/include.js"></script>
   
   <!-- If include.js doesn't exist, use this fallback -->
   <script>
        // Fallback header and footer loading if include.js is not available
        document.addEventListener('DOMContentLoaded', function() {
            // Load header
            fetch('./includes/header.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Header not found');
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('header').innerHTML = data;
                    // Initialize mobile menu after header is loaded
                    initMobileMenu();
                })
                .catch(error => {
                    console.error('Error loading header:', error);
                    // Create an elegant header as fallback
                    document.getElementById('header').innerHTML = `
                        <header class="navbar">
                            <div class="container">
                                <div class="nav-brand">
                                    <a href="index.html">LibraConnect</a>
                                </div>
                                <div class="menu-icon" id="menuToggle">
                                    <i class="fas fa-bars"></i>
                                </div>
                                <ul class="nav-menu">
                                    <li><a href="index.html">Home</a></li>
                                    <li><a href="catalog.html" class="active">Book Catalog</a></li>
                                    <li><a href="borrow.html">Borrow Books</a></li>
                                    <li><a href="history.html">History</a></li>
                                    <li><a href="pages/register.html">Register/Login</a></li>
                                </ul>
                            </div>
                        </header>
                    `;
                    initMobileMenu();
                });

            // Load footer
            fetch('./includes/footer.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Footer not found');
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('footer').innerHTML = data;
                })
                .catch(error => {
                    console.error('Error loading footer:', error);
                    // Create an elegant footer as fallback
                    document.getElementById('footer').innerHTML = `
                        <footer>
                            <div class="container">
                                <div class="footer-content">
                                    <div class="footer-section">
                                        <h3>LibraConnect</h3>
                                        <p>Your gateway to a world of knowledge and imagination. Explore our extensive collection of books, digital resources, and community events.</p>
                                        <div class="social-icons">
                                            <a href="#"><i class="fab fa-facebook-f"></i></a>
                                            <a href="#"><i class="fab fa-twitter"></i></a>
                                            <a href="#"><i class="fab fa-instagram"></i></a>
                                            <a href="#"><i class="fab fa-linkedin-in"></i></a>
                                        </div>
                                    </div>
                                    
                                    <div class="footer-section">
                                        <h3>Quick Links</h3>
                                        <ul class="footer-links">
                                            <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                                            <li><a href="catalog.html"><i class="fas fa-book"></i> Book Catalog</a></li>
                                            <li><a href="borrow.html"><i class="fas fa-hand-holding-usd"></i> Borrow Books</a></li>
                                            <li><a href="history.html"><i class="fas fa-history"></i> Books History</a></li>
                                        </ul>
                                    </div>
                                    
                                    <div class="footer-section">
                                        <h3>Resources</h3>
                                        <ul class="footer-links">
                                            <li><a href="research.html"><i class="fas fa-search"></i> Research Tools</a></li>
                                            <li><a href="ebooks.html"><i class="fas fa-tablet-alt"></i> E-Books</a></li>
                                            <li><a href="audiobooks.html"><i class="fas fa-headphones"></i> Audiobooks</a></li>
                                            <li><a href="databases.html"><i class="fas fa-database"></i> Online Databases</a></li>
                                        </ul>
                                    </div>
                                    
                                    <div class="footer-section">
                                        <h3>Contact Us</h3>
                                        <ul class="footer-links">
                                            <li><i class="fas fa-map-marker-alt"></i> 123 Library Street, Bookville</li>
                                            <li><i class="fas fa-phone"></i> (555) 123-4567</li>
                                            <li><i class="fas fa-envelope"></i> info@libraconnect.org</li>
                                            <li><i class="fas fa-clock"></i> Mon-Fri: 9am-8pm, Sat: 10am-6pm</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="copyright">
                                    <p>&copy; 2023 LibraConnect Library. All rights reserved.</p>
                                </div>
                            </div>
                        </footer>
                    `;
                });
        });

        function initMobileMenu() {
            const menuToggle = document.getElementById('menuToggle');
            if (menuToggle) {
                menuToggle.addEventListener('click', function() {
                    const navMenu = document.querySelector('.nav-menu');
                    if (navMenu) {
                        navMenu.classList.toggle('open');
                    }
                });
            }
        }
   </script>

    <!-- Your catalog JavaScript -->
    <script>
        const books = [
            {
                id: 1,
                title: "The Great Gatsby",
                author: "F. Scott Fitzgerald",
                genre: "Classic Literature",
                description: "A classic novel of the Jazz Age, depicting the decadence and excess of the 1920s through the eyes of narrator Nick Carraway.",
                cover: "assets/images/greatgatsby.jpeg",
                available: true,
                year: 1925
            },
            {
                id: 2,
                title: "To Kill a Mockingbird",
                author: "Harper Lee",
                genre: "Fiction",
                description: "A gripping tale of racial injustice and childhood innocence in the American South, seen through the eyes of young Scout Finch.",
                cover: "assets/images/tokillamockingbird.jpeg",
                available: true,
                year: 1960
            },
            {
                id: 3,
                title: "1984",
                author: "George Orwell",
                genre: "Dystopian Fiction",
                description: "A chilling vision of a totalitarian future where critical thought is suppressed under the watchful eye of Big Brother.",
                cover: "assets/images/1984.jpg",
                available: false,
                year: 1949
            },
            {
                id: 4,
                title: "Pride and Prejudice",
                author: "Jane Austen",
                genre: "Romance",
                description: "A timeless romance exploring societal expectations and personal growth in 19th century England.",
                cover: "assets/images/prideandprejudice.jpg",
                available: true,
                year: 1813
            },
            {
                id: 5,
                title: "The Hobbit",
                author: "J.R.R. Tolkien",
                genre: "Fantasy",
                description: "An epic fantasy adventure that follows Bilbo Baggins on an unexpected journey to reclaim the Lonely Mountain.",
                cover: "assets/images/thehobbit.jpeg",
                available: true,
                year: 1937
            },
            {
                id: 6,
                title: "Harry Potter and the Sorcerer's Stone",
                author: "J.K. Rowling",
                genre: "Fantasy",
                description: "The first book in the beloved series about a young wizard's journey at Hogwarts School of Witchcraft and Wizardry.",
                cover: "assets/images/harrypot.jpeg", 
                available: true,
                year: 1997
            },
            {
                id: 7,
                title: "The Catcher in the Rye",
                author: "J.D. Salinger",
                genre: "Fiction",
                description: "A controversial novel exploring teenage rebellion and alienation through the eyes of protagonist Holden Caulfield.",
                cover: "assets/images/rey.jpeg",
                available: false,
                year: 1951
            },
            {
                id: 8,
                title: "Lord of the Flies",
                author: "William Golding",
                genre: "Fiction",
                description: "A harrowing tale of a group of boys stranded on an uninhabited island and their descent into savagery.",
                cover: "assets/images/lordoftheflies.jpeg",
                available: true,
                year: 1954
            },
            {
                id: 9,
                title: "Brave New World",
                author: "Aldous Huxley",
                genre: "Science Fiction",
                description: "A visionary novel about a futuristic society where people are genetically engineered and conditioned for specific roles.",
                cover: "assets/images/bravenewworld.jpeg",
                available: true,
                year: 1932
            },
            {
                id: 10,
                title: "The Alchemist",
                author: "Paulo Coelho",
                genre: "Adventure",
                description: "A philosophical book that follows a young Andalusian shepherd on his journey to find his Personal Legend.",
                cover: "assets/images/alchemist.jpg",
                available: true,
                year: 1988
            },
            {
                id: 11,
                title: "Omniscient Reader's Viewpoint",
                author: "singNsong",
                genre: "Action, Fantasy, Metafiction",
                description: "Kim Dokja is a young man leading a simple life, who has been the sole reader of a novel, Three Ways to Survive in a Ruined World, alternatively translated as Ways of Survival, for 13 years of his life. On the day the final chapter was published, reality and fiction began to merge, becoming the world of the story. Being the only person who knew how the story went, Kim Dokja is determined to create a different ending through various challenges",
                cover: "assets/images/orv.jpg",
                available: true,
                year: 2018
            }
        ];

        // Enhanced responsive grid system
        let currentGridColumns = calculateGridColumns();

        function calculateGridColumns() {
            const width = window.innerWidth;
            if (width >= 1200) return 4;
            if (width >= 992) return 3;
            if (width >= 768) return 2;
            return 1;
        }

        // Function to render books with enhanced responsive design
        function renderBooks(booksToRender) {
            const booksContainer = document.getElementById('booksContainer');
            const noResults = document.getElementById('noResults');
            
            if (!booksContainer || !noResults) {
                console.error('Required DOM elements not found');
                return;
            }
            
            // Clear previous content
            booksContainer.innerHTML = '';
            
            if (booksToRender.length === 0) {
                noResults.style.display = 'block';
                updateResultsCounter(0);
                return;
            }
            
            noResults.style.display = 'none';
            updateResultsCounter(booksToRender.length);
            
            // Create document fragment for better performance
            const fragment = document.createDocumentFragment();
            
            // Loop through book data and create cards
            booksToRender.forEach(book => {
                const bookCard = createBookCard(book);
                fragment.appendChild(bookCard);
            });
            
            booksContainer.appendChild(fragment);
        }

        // Enhanced function to create individual book card with better image handling
        function createBookCard(book) {
            const bookCard = document.createElement('div');
            bookCard.className = 'book-card';
            bookCard.setAttribute('data-title', book.title.toLowerCase());
            bookCard.setAttribute('data-author', book.author.toLowerCase());
            bookCard.setAttribute('data-genre', book.genre.toLowerCase());
            
            bookCard.innerHTML = `
                <div class="book-cover-container">
                    <img src="${book.cover}" class="book-cover" alt="${book.title}" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDMwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iNDAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0xMjUgMTUwSDE3NVYyNTBIMTI1VjE1MFoiIGZpbGw9IiNEOEQ4RDgiLz4KPHN2Zz4K'; this.alt='Cover image not available'">
                </div>
                <div class="book-info">
                    <h3 class="book-title">${book.title}</h3>
                    <p class="book-author">by ${book.author}</p>
                    <p class="book-description">${book.description}</p>
                    <div class="book-meta">
                        <span class="genre-tag">${book.genre}</span>
                        <span class="availability ${book.available ? 'available' : 'unavailable'}">
                            ${book.available ? 'Available' : 'Checked Out'}
                        </span>
                    </div>
                    <div class="book-year">
                        <small class="text-muted">Published: ${book.year}</small>
                    </div>
                    <a href="../borrow.html?id=${book.id}" class="borrow-btn-link">
                    <button class="borrow-btn" ${!book.available ? 'disabled' : ''}>
                        ${book.available ? 'Borrow This Book' : 'Currently Unavailable'}
                    </button>
                    </a>
                </div>
            `;
            
            return bookCard;
        }

        // Function to update results counter
        function updateResultsCounter(count) {
            let counter = document.getElementById('resultsCounter');
            if (!counter) {
                counter = document.createElement('div');
                counter.id = 'resultsCounter';
                counter.className = 'results-counter';
                const searchSection = document.querySelector('.search-section');
                if (searchSection) {
                    searchSection.appendChild(counter);
                }
            }
            
            if (count === books.length || count === 0) {
                counter.style.display = 'none';
            } else {
                counter.style.display = 'block';
                counter.textContent = `Found ${count} book${count !== 1 ? 's' : ''}`;
            }
        }

        // FIXED: Search function that properly handles multi-genre books
        function filterBooks() {
            const searchInput = document.getElementById('searchInput');
            const genreFilter = document.getElementById('genreFilter');
            
            if (!searchInput || !genreFilter) return;
            
            const searchTerm = searchInput.value.toLowerCase().trim();
            const selectedGenre = genreFilter.value;
            
            let filteredBooks = books;
            
            // Apply genre filter if selected - FIXED TO HANDLE EXACT GENRE MATCHING
            if (selectedGenre !== '') {
                filteredBooks = filteredBooks.filter(book => {
                    // Split the book's genre string into individual genres
                    const bookGenres = book.genre.split(', ').map(genre => genre.trim().toLowerCase());
                    const selectedGenreLower = selectedGenre.toLowerCase();
                    
                    // Check if any of the individual genres exactly matches the selected genre
                    return bookGenres.some(genre => genre === selectedGenreLower);
                });
            }
            
            // Apply search filter if there's a search term
            if (searchTerm !== '') {
                filteredBooks = filteredBooks.filter(book => 
                    book.title.toLowerCase().includes(searchTerm) ||
                    book.author.toLowerCase().includes(searchTerm) ||
                    book.genre.toLowerCase().includes(searchTerm)
                );
            }
            
            renderBooks(filteredBooks);
        }

        // Enhanced debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Initialize the application with error handling
        function initializeApp() {
            try {
                // Initial render of all books
                renderBooks(books);
                
                // Search functionality
                const searchInput = document.getElementById('searchInput');
                const searchButton = document.getElementById('searchButton');
                const genreFilter = document.getElementById('genreFilter');
                
                if (!searchInput || !searchButton || !genreFilter) {
                    console.error('Search elements not found');
                    return;
                }
                
                const debouncedFilter = debounce(filterBooks, 300);
                
                // Live search with keyup event
                searchInput.addEventListener('keyup', debouncedFilter);
                
                // Search button event
                searchButton.addEventListener('click', filterBooks);
                
                // Genre filter change event
                genreFilter.addEventListener('change', filterBooks);
                
                // Clear search when input is emptied
                searchInput.addEventListener('input', function() {
                    if (this.value === '') {
                        filterBooks();
                    }
                });
                
                // Enter key support
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        filterBooks();
                    }
                });
                
                // Enhanced responsive layout handling
                window.addEventListener('resize', debounce(function() {
                    const newGridColumns = calculateGridColumns();
                    if (newGridColumns !== currentGridColumns) {
                        currentGridColumns = newGridColumns;
                        renderBooks(books);
                    }
                }, 250));
                
                // Add keyboard navigation
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        searchInput.value = '';
                        genreFilter.value = '';
                        renderBooks(books);
                        searchInput.focus();
                    }
                });
                
            } catch (error) {
                console.error('Error initializing application:', error);
            }
        }

        // Wait for DOM to be fully loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>